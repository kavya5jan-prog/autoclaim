<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Content Extractor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Auto Claims File Manager</h1>
            <p>Upload and view claim-related documents</p>
        </header>

        <div class="files-section" id="filesSection">
            <div class="files-tabs">
                <div class="file-tab active" data-tab="files" onclick="switchTab('files')">
                    <span>üìÅ Files</span>
                </div>
                <div class="file-tab" data-tab="summary" onclick="switchTab('summary')">
                    <span>üìä Summary</span>
                </div>
                <div class="file-tab" data-tab="fact-matrix" onclick="switchTab('fact-matrix')">
                    <span>üîç Fact Matrix</span>
                </div>
                <div class="file-tab" data-tab="liability-signals" onclick="switchTab('liability-signals')">
                    <span>‚öñÔ∏è Liability Signals</span>
                </div>
                <div class="file-tab" data-tab="evidence-completeness" onclick="switchTab('evidence-completeness')">
                    <span>‚úÖ Evidence Completeness</span>
                </div>
                <div class="file-tab" data-tab="coverage-impact" onclick="switchTab('coverage-impact')">
                    <span>üõ°Ô∏è Coverage Impact</span>
                </div>
                <div class="file-tab" data-tab="liability-recommendation" onclick="switchTab('liability-recommendation')">
                    <span>üìä Liability % Recommendation</span>
                </div>
                <div class="file-tab" data-tab="timeline" onclick="switchTab('timeline')">
                    <span>üïê Timeline Reconstruction</span>
                </div>
                <div class="file-tab" data-tab="claim-rationale" onclick="switchTab('claim-rationale')">
                    <span>üìù Draft Claim Rationale</span>
                </div>
                <div class="file-tab" data-tab="escalation-package" onclick="switchTab('escalation-package')">
                    <span>‚ö†Ô∏è Supervisor Escalation</span>
                </div>
            </div>
            
            <div class="content-section">
                <!-- Files Tab -->
                <div class="tab-content active" id="filesTab">
                    <div class="file-list-container" id="fileListContainer">
                        <div class="file-list-header">
                            <h2>Claim Documents</h2>
                            <button class="summary-button" id="extractFactsButton" onclick="extractFacts()">
                                üîç Extract Facts
                            </button>
                        </div>
                        <div class="file-list" id="fileList">
                            <!-- File list items will be generated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="file-content-view" id="fileContentView" style="display: none;">
                        <div class="metadata" id="metadata"></div>
                        <div class="pages" id="pages"></div>
                    </div>
                </div>
                
                <!-- Summary Tab -->
                <div class="tab-content" id="summaryTab" style="display: none;">
                    <div class="summary-view" id="summaryView">
                        <div class="summary-header">
                            <h2>Claim Summary</h2>
                            <button class="summary-button" onclick="generateSummary()">üìä Generate Summary</button>
                        </div>
                        <div class="summary-content" id="summaryContent">
                            <!-- Summary will be displayed here -->
                            <p class="empty-state">Click "Generate Summary" to create a summary of all uploaded documents.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Fact Matrix Tab -->
                <div class="tab-content" id="factMatrixTab" style="display: none;">
                    <div class="fact-matrix-view" id="factMatrixView">
                        <div class="fact-matrix-header">
                            <h2>Fact Matrix</h2>
                            <button class="export-button" id="exportButton" onclick="exportFactsAsJSON()">üì• Export JSON</button>
                        </div>
                    
                    <div class="fact-matrix-controls">
                        <div class="filter-group">
                            <label for="categoryFilter">Category:</label>
                            <select id="categoryFilter" onchange="filterFacts()">
                                <option value="">All Categories</option>
                                <option value="movement">Movement</option>
                                <option value="environment">Environment</option>
                                <option value="compliance">Compliance</option>
                                <option value="impact">Impact</option>
                                <option value="location">Location</option>
                                <option value="temporal">Temporal</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="sourceFilter">Source:</label>
                            <select id="sourceFilter" onchange="filterFacts()">
                                <option value="">All Sources</option>
                                <option value="fnol">FNOL</option>
                                <option value="claimant">Claimant</option>
                                <option value="other_driver">Other Driver</option>
                                <option value="police">Police</option>
                                <option value="repair_estimate">Repair Estimate</option>
                                <option value="policy">Policy</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="searchFilter">Search:</label>
                            <input type="text" id="searchFilter" placeholder="Search facts..." oninput="filterFacts()">
                        </div>
                        <div class="filter-group">
                            <label for="sortBy">Sort by:</label>
                            <select id="sortBy" onchange="filterFacts()">
                                <option value="confidence">Confidence (High to Low)</option>
                                <option value="confidence-asc">Confidence (Low to High)</option>
                                <option value="category">Category</option>
                                <option value="source">Source</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="conflicts-section" id="conflictsSection" style="display: none;">
                        <h3>‚ö†Ô∏è Conflicting Facts</h3>
                        <div id="conflictsContent"></div>
                    </div>
                    
                    <div class="fact-matrix-content">
                        <div class="fact-table-container">
                            <table class="fact-table" id="factTable">
                                <thead>
                                    <tr>
                                        <th>Source Text</th>
                                        <th>Extracted Fact</th>
                                        <th>Category</th>
                                        <th>Source</th>
                                        <th>Implied</th>
                                        <th>Contradicting</th>
                                    </tr>
                                </thead>
                                <tbody id="factTableBody">
                                    <!-- Facts will be rendered here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    </div>
                </div>
                
                <!-- Liability Signals Tab -->
                <div class="tab-content" id="liabilitySignalsTab" style="display: none;">
                    <div class="liability-signals-view" id="liabilitySignalsView">
                        <div class="liability-signals-header">
                            <h2>Liability Signals</h2>
                            <button class="summary-button" id="analyzeSignalsButton" onclick="analyzeLiabilitySignals()">
                                ‚öñÔ∏è Analyze Signals
                            </button>
                        </div>
                    
                        <div class="liability-signals-content">
                            <div class="liability-signals-table-container">
                                <table class="liability-signals-table" id="liabilitySignalsTable">
                                    <thead>
                                        <tr>
                                            <th>Signal Type</th>
                                            <th>Evidence Text</th>
                                            <th>Impact on Liability</th>
                                            <th>Severity Score</th>
                                            <th>Related Facts</th>
                                            <th>Discrepancies</th>
                                        </tr>
                                    </thead>
                                    <tbody id="liabilitySignalsTableBody">
                                        <!-- Signals will be rendered here -->
                                        <tr>
                                            <td colspan="6" style="text-align: center; padding: 40px;">
                                                <p class="empty-state">Click "Analyze Signals" to identify liability signals from the fact matrix.</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Evidence Completeness Tab -->
                <div class="tab-content" id="evidenceCompletenessTab" style="display: none;">
                    <div class="evidence-completeness-view" id="evidenceCompletenessView">
                        <div class="evidence-completeness-header">
                            <h2>Evidence Completeness Check</h2>
                            <button class="summary-button" id="checkEvidenceButton" onclick="checkEvidenceCompleteness()">
                                ‚úÖ Check Completeness
                            </button>
                        </div>
                    
                        <div class="evidence-completeness-content">
                            <!-- Checks Summary Section -->
                            <div class="checks-summary-section" id="checksSummarySection" style="display: none;">
                                <h3>Completeness Checks</h3>
                                <div class="checks-grid" id="checksGrid">
                                    <!-- Checks will be rendered here -->
                                </div>
                            </div>
                            
                            <!-- Missing Evidence Checklist Section -->
                            <div class="missing-evidence-section" id="missingEvidenceSection" style="display: none;">
                                <h3>Missing Evidence Checklist</h3>
                                <div class="missing-evidence-list" id="missingEvidenceList">
                                    <!-- Missing evidence items will be rendered here -->
                                </div>
                            </div>
                            
                            <!-- Empty State -->
                            <div class="empty-state-container" id="evidenceEmptyState">
                                <p class="empty-state">Extract facts first, then click "Check Completeness" to analyze the evidence package for missing items.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Coverage Impact Tab -->
                <div class="tab-content" id="coverageImpactTab" style="display: none;">
                    <div class="coverage-impact-view" id="coverageImpactView">
                        <div class="coverage-impact-header">
                            <h2>Coverage Impact Detector</h2>
                            <button class="summary-button" id="analyzeCoverageButton" onclick="analyzeCoverageImpact()">
                                üõ°Ô∏è Analyze Coverage Impact
                            </button>
                        </div>
                    
                        <div class="coverage-impact-content">
                            <div class="coverage-impact-table-container">
                                <table class="coverage-impact-table" id="coverageImpactTable">
                                    <thead>
                                        <tr>
                                            <th>Triggering Fact</th>
                                            <th>Source</th>
                                            <th>Policy Clause</th>
                                            <th>Risk Level</th>
                                            <th>Coverage Exclusion Type</th>
                                            <th>Explanation</th>
                                        </tr>
                                    </thead>
                                    <tbody id="coverageImpactTableBody">
                                        <!-- Coverage impacts will be rendered here -->
                                        <tr>
                                            <td colspan="6" style="text-align: center; padding: 40px;">
                                                <p class="empty-state">Extract facts first, then click "Analyze Coverage Impact" to identify coverage-relevant facts.</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Liability Recommendation Tab -->
                <div class="tab-content" id="liabilityRecommendationTab" style="display: none;">
                    <div class="liability-recommendation-view" id="liabilityRecommendationView">
                        <div class="liability-recommendation-header">
                            <h2>Liability % Recommendation</h2>
                            <button class="summary-button" id="getRecommendationButton" onclick="getLiabilityRecommendation()">
                                üìä Get Recommendation
                            </button>
                        </div>
                    
                        <div class="liability-recommendation-content">
                            <div class="recommendation-form" id="recommendationForm" style="display: none;">
                                <div class="recommendation-percentages">
                                    <div class="percentage-input-group">
                                        <label for="claimantLiabilityPercent">Claimant Liability:</label>
                                        <div class="percentage-input-container">
                                            <input type="number" id="claimantLiabilityPercent" min="0" max="100" value="0" onchange="updateLiabilityPercentages()">
                                            <span class="percentage-symbol">%</span>
                                        </div>
                                    </div>
                                    <div class="percentage-input-group">
                                        <label for="otherDriverLiabilityPercent">Other Driver Liability:</label>
                                        <div class="percentage-input-container">
                                            <input type="number" id="otherDriverLiabilityPercent" min="0" max="100" value="0" onchange="updateLiabilityPercentages()">
                                            <span class="percentage-symbol">%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="recommendation-explanation">
                                    <label for="recommendationExplanation">Explanation:</label>
                                    <textarea id="recommendationExplanation" rows="10" placeholder="Explanation will appear here..."></textarea>
                                </div>
                                
                                <div class="recommendation-details">
                                    <div class="key-factors-section">
                                        <h3>Key Factors</h3>
                                        <ul id="keyFactorsList">
                                            <!-- Key factors will be rendered here -->
                                        </ul>
                                    </div>
                                    
                                    <div class="confidence-section">
                                        <h3>Confidence</h3>
                                        <div class="confidence-display">
                                            <div class="confidence-bar">
                                                <div class="confidence-fill" id="confidenceFill" style="width: 0%"></div>
                                            </div>
                                            <span class="confidence-text" id="confidenceText">0%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="recommendation-actions">
                                    <button class="update-button" onclick="updateLiabilityRecommendation()">
                                        üíæ Update Recommendation
                                    </button>
                                </div>
                            </div>
                            
                            <div class="empty-state-container" id="recommendationEmptyState">
                                <p class="empty-state">Extract facts and analyze liability signals first, then click "Get Recommendation" to generate a liability percentage recommendation.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Timeline Reconstruction Tab -->
                <div class="tab-content" id="timelineTab" style="display: none;">
                    <div class="timeline-view" id="timelineView">
                        <div class="timeline-header">
                            <h2>Timeline Reconstruction</h2>
                            <div class="timeline-header-actions">
                                <button class="summary-button" id="generateTimelineButton" onclick="generateTimeline()">
                                    üïê Generate Timeline
                                </button>
                                <button class="summary-button" id="saveTimelineButton" onclick="saveTimeline()" style="display: none; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    üíæ Save Timeline
                                </button>
                            </div>
                        </div>
                    
                        <div class="timeline-content">
                            <div class="timeline-events-container" id="timelineEventsContainer" style="display: none;">
                                <ol class="timeline-events-list" id="timelineEventsList">
                                    <!-- Timeline events will be rendered here -->
                                </ol>
                            </div>
                            
                            <div class="empty-state-container" id="timelineEmptyState">
                                <p class="empty-state">Extract facts first, then click "Generate Timeline" to reconstruct the sequence of events leading to the collision.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Draft Claim Rationale Tab -->
                <div class="tab-content" id="claimRationaleTab" style="display: none;">
                    <div class="claim-rationale-view" id="claimRationaleView">
                        <div class="claim-rationale-header">
                            <h2>Draft Claim File Rationale</h2>
                            <button class="summary-button" id="generateRationaleButton" onclick="generateClaimRationale()">
                                üìù Generate Rationale
                            </button>
                        </div>
                    
                        <div class="claim-rationale-content">
                            <div class="rationale-display" id="rationaleDisplay" style="display: none;">
                                <!-- Rationale will be displayed here -->
                            </div>
                            
                            <div class="empty-state-container" id="rationaleEmptyState">
                                <p class="empty-state">Extract facts and analyze liability signals first, then click "Generate Rationale" to create an audit-ready adjuster narrative.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Supervisor Escalation Package Tab -->
                <div class="tab-content" id="escalationPackageTab" style="display: none;">
                    <div class="escalation-package-view" id="escalationPackageView">
                        <div class="escalation-package-header">
                            <h2>Supervisor Escalation Packaging</h2>
                            <button class="summary-button" id="generateEscalationButton" onclick="generateEscalationPackage()">
                                ‚ö†Ô∏è Generate Escalation Package
                            </button>
                        </div>
                    
                        <div class="escalation-package-content">
                            <div class="escalation-display" id="escalationDisplay" style="display: none;">
                                <!-- Escalation package will be displayed here -->
                            </div>
                            
                            <div class="empty-state-container" id="escalationEmptyState">
                                <p class="empty-state">Extract facts and analyze liability signals first, then click "Generate Escalation Package" to create a condensed high-risk summary for supervisor review.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Processing file...</p>
        </div>

        <div class="error" id="error" style="display: none;"></div>
        
        <!-- Hidden file input for uploads -->
        <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png,.gif,.webp,.bmp" hidden>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>


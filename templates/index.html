<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Content Extractor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>AVA</h1>
            <p>Automated Vehicle Adjudicator</p>
        </header>

        <div class="files-section" id="filesSection">
            <!-- Step Progress Indicator -->
            <div class="step-progress-container">
                <!-- Segmented Progress Bar - ABOVE step indicators -->
                <div class="segmented-progress-bar" id="segmentedProgressBar">
                    <div class="progress-segment" data-step-index="0"></div>
                    <div class="progress-segment" data-step-index="1"></div>
                    <div class="progress-segment" data-step-index="2"></div>
                    <div class="progress-segment" data-step-index="3"></div>
                    <div class="progress-segment" data-step-index="4"></div>
                    <div class="progress-segment" data-step-index="5"></div>
                    <div class="progress-segment" data-step-index="6"></div>
                    <div class="progress-segment" data-step-index="7"></div>
                </div>
                
                <!-- Step Indicators - BELOW progress bar -->
                <div class="step-indicators">
                    <div class="step-item completed" data-step="files" onclick="switchTab('files')">
                        <div class="step-icon">
                            <!-- Files icon -->
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M5.83333 3.33333H11.6667L14.1667 5.83333V16.6667H5.83333V3.33333Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M11.6667 3.33333V5.83333H14.1667" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <span class="step-label">Files</span>
                    </div>
                    <div class="step-item" data-step="fact-matrix" onclick="switchTab('fact-matrix')">
                        <div class="step-icon">
                            <!-- Fact Matrix / Grid icon -->
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M3.33333 3.33333H8.33333V8.33333H3.33333V3.33333Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M11.6667 3.33333H16.6667V8.33333H11.6667V3.33333Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M3.33333 11.6667H8.33333V16.6667H3.33333V11.6667Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M11.6667 11.6667H16.6667V16.6667H11.6667V11.6667Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <span class="step-label">Fact Matrix</span>
                    </div>
                    <div class="step-item" data-step="liability-signals" onclick="switchTab('liability-signals')">
                        <div class="step-icon">
                            <!-- Liability Signals / Warning icon -->
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M10 3.33333L3.33333 16.6667H16.6667L10 3.33333Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M10 11.6667V8.33333" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <circle cx="10" cy="13.3333" r="0.833333" fill="currentColor"/>
                            </svg>
                        </div>
                        <span class="step-label">Liability Signals</span>
                    </div>
                    <div class="step-item" data-step="evidence-completeness" onclick="switchTab('evidence-completeness')">
                        <div class="step-icon">
                            <!-- Evidence Completeness / Checklist icon -->
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M16.6667 5L7.50004 14.1667L3.33337 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M3.33333 10H7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7.5 14.1667L16.6667 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <span class="step-label">Evidence Completeness</span>
                    </div>
                    <div class="step-item" data-step="liability-recommendation" onclick="switchTab('liability-recommendation')">
                        <div class="step-icon">
                            <!-- Liability % Recommendation / Percentage icon -->
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M10 3.33333C6.31814 3.33333 3.33333 6.31814 3.33333 10C3.33333 13.6819 6.31814 16.6667 10 16.6667C13.6819 16.6667 16.6667 13.6819 16.6667 10C16.6667 6.31814 13.6819 3.33333 10 3.33333Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M10 6.66667V10L12.5 12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7.5 7.5H12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                <path d="M7.5 12.5H12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <span class="step-label">Liability % Recommendation</span>
                    </div>
                    <div class="step-item locked" data-step="timeline" onclick="switchTab('timeline')">
                        <div class="step-icon">
                            <!-- Timeline Reconstruction / Clock icon -->
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <circle cx="10" cy="10" r="7.5" stroke="currentColor" stroke-width="2"/>
                                <path d="M10 5V10L13.3333 13.3333" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <span class="step-label">Timeline Reconstruction</span>
                    </div>
                    <div class="step-item locked" data-step="claim-rationale" onclick="switchTab('claim-rationale')">
                        <div class="step-icon">
                            <!-- Draft Claim Rationale / Document edit icon -->
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M5 5H15V15H5V5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M7.5 7.5H12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                <path d="M7.5 10H12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                <path d="M7.5 12.5H10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                                <path d="M12.5 7.5L15 10L12.5 12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <span class="step-label">Draft Claim Rationale</span>
                    </div>
                    <div class="step-item locked" data-step="escalation-package" onclick="switchTab('escalation-package')">
                        <div class="step-icon">
                            <!-- Supervisor Escalation / Shield icon -->
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                                <path d="M10 3.33333L3.33333 6.66667V10C3.33333 14.1667 6.66667 16.6667 10 17.5C13.3333 16.6667 16.6667 14.1667 16.6667 10V6.66667L10 3.33333Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <span class="step-label">Supervisor Escalation</span>
                    </div>
                </div>
            </div>
            
            <div class="content-section">
                <!-- Files Tab -->
                <div class="tab-content active" id="filesTab">
                    <div class="file-list-container" id="fileListContainer">
                        <div class="file-list-header">
                            <h2>Claim Documents</h2>
                            <div class="header-actions">
                                <button class="summary-button" id="extractFactsButton" onclick="extractFacts()">
                                    Extract Facts & Continue
                                </button>
                            </div>
                        </div>
                        <div class="file-list" id="fileList">
                            <!-- File list items will be generated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="file-content-view" id="fileContentView" style="display: none;">
                        <div class="metadata" id="metadata"></div>
                        <div class="pages" id="pages"></div>
                    </div>
                </div>
                
                <!-- Fact Matrix Tab -->
                <div class="tab-content" id="factMatrixTab" style="display: none;">
                    <div class="fact-matrix-view" id="factMatrixView">
                        <div class="fact-matrix-header">
                            <h2>Fact Matrix</h2>
                            <button class="export-button" id="exportButton" onclick="exportFactsAsJSON()">Export JSON</button>
                        </div>
                    
                    <div class="fact-matrix-controls">
                        <div class="filter-group">
                            <label for="categoryFilter">Category:</label>
                            <select id="categoryFilter" onchange="filterFacts()">
                                <option value="">All Categories</option>
                                <option value="movement">Movement</option>
                                <option value="environment">Environment</option>
                                <option value="compliance">Compliance</option>
                                <option value="impact">Impact</option>
                                <option value="location">Location</option>
                                <option value="temporal">Temporal</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="sourceFilter">Source:</label>
                            <select id="sourceFilter" onchange="filterFacts()">
                                <option value="">All Sources</option>
                                <option value="fnol">FNOL</option>
                                <option value="claimant">Claimant</option>
                                <option value="other_driver">Other Driver</option>
                                <option value="police">Police</option>
                                <option value="repair_estimate">Repair Estimate</option>
                                <option value="policy">Policy</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label for="searchFilter">Search:</label>
                            <input type="text" id="searchFilter" placeholder="Search facts..." oninput="filterFacts()">
                        </div>
                        <div class="filter-group">
                            <label for="sortBy">Sort by:</label>
                            <select id="sortBy" onchange="filterFacts()">
                                <option value="confidence">Confidence (High to Low)</option>
                                <option value="confidence-asc">Confidence (Low to High)</option>
                                <option value="category">Category</option>
                                <option value="source">Source</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="tab-loading" id="factMatrixLoading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Processing...</p>
                    </div>
                    
                    <div class="fact-matrix-split-container" id="factMatrixSplitContainer">
                        <div class="conflicts-panel" id="conflictsPanel" style="display: none;">
                            <h3>Conflicting Facts</h3>
                            <div id="conflictsContent"></div>
                        </div>
                        
                        <div class="fact-matrix-content">
                            <div class="fact-table-container">
                                <table class="fact-table" id="factTable">
                                    <thead>
                                        <tr>
                                            <th>Fact #</th>
                                            <th>Source Text</th>
                                            <th>Extracted Fact</th>
                                            <th>Category</th>
                                            <th>Source</th>
                                            <th>Implied</th>
                                            <th>Contradicting</th>
                                        </tr>
                                    </thead>
                                    <tbody id="factTableBody">
                                        <!-- Facts will be rendered here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <div class="accepted-decisions-section" id="acceptedDecisionsSection" style="display: none;">
                        <h3>Accepted Decisions</h3>
                        <div class="accepted-decisions-table-container">
                            <table class="accepted-decisions-table" id="acceptedDecisionsTable">
                                <thead>
                                    <tr>
                                        <th>Conflict Description</th>
                                        <th>Accepted Value</th>
                                        <th>Resolved</th>
                                    </tr>
                                </thead>
                                <tbody id="acceptedDecisionsTableBody">
                                    <!-- Accepted decisions will be rendered here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    </div>
                </div>
                
                <!-- Liability Signals Tab -->
                <div class="tab-content" id="liabilitySignalsTab" style="display: none;">
                    <div class="liability-signals-view" id="liabilitySignalsView">
                        <div class="liability-signals-header">
                            <h2>Liability Signals</h2>
                            <button class="summary-button" id="analyzeSignalsButton" onclick="analyzeLiabilitySignals()">
                                Analyze Signals
                            </button>
                        </div>
                    
                        <div class="liability-signals-content">
                            <div class="tab-loading" id="liabilitySignalsLoading" style="display: none;">
                                <div class="spinner"></div>
                                <p>Processing...</p>
                            </div>
                            <div class="liability-signals-table-container">
                                <table class="liability-signals-table" id="liabilitySignalsTable">
                                    <thead>
                                        <tr>
                                            <th>Signal Type</th>
                                            <th>Evidence Text</th>
                                            <th>Impact on Liability</th>
                                            <th>Severity Score</th>
                                            <th>Related Facts</th>
                                            <th>Discrepancies</th>
                                        </tr>
                                    </thead>
                                    <tbody id="liabilitySignalsTableBody">
                                        <!-- Signals will be rendered here -->
                                        <tr>
                                            <td colspan="6" style="text-align: center; padding: 40px;">
                                                <p class="empty-state">Click "Analyze Signals" to identify liability signals from the fact matrix.</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Evidence Completeness Tab -->
                <div class="tab-content" id="evidenceCompletenessTab" style="display: none;">
                    <div class="evidence-completeness-view" id="evidenceCompletenessView">
                        <div class="evidence-completeness-header">
                            <h2>Evidence Completeness Check</h2>
                            <button class="summary-button" id="checkEvidenceButton" onclick="checkEvidenceCompleteness()">
                                Check Completeness
                            </button>
                        </div>
                    
                        <div class="evidence-completeness-content">
                            <div class="tab-loading" id="evidenceCompletenessLoading" style="display: none;">
                                <div class="spinner"></div>
                                <p>Processing...</p>
                            </div>
                            <!-- Checks Summary Section -->
                            <div class="checks-summary-section" id="checksSummarySection" style="display: none;">
                                <h3>Completeness Checks</h3>
                                <div class="checks-grid" id="checksGrid">
                                    <!-- Checks will be rendered here -->
                                </div>
                            </div>
                            
                            <!-- Missing Evidence Checklist Section -->
                            <div class="missing-evidence-section" id="missingEvidenceSection" style="display: none;">
                                <h3>Missing Evidence Checklist</h3>
                                <div class="missing-evidence-list" id="missingEvidenceList">
                                    <!-- Missing evidence items will be rendered here -->
                                </div>
                            </div>
                            
                            <!-- Empty State -->
                            <div class="empty-state-container" id="evidenceEmptyState">
                                <p class="empty-state">Extract facts first, then click "Check Completeness" to analyze the evidence package for missing items.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Liability Recommendation Tab -->
                <div class="tab-content" id="liabilityRecommendationTab" style="display: none;">
                    <div class="liability-recommendation-view" id="liabilityRecommendationView">
                        <div class="liability-recommendation-header">
                            <h2>Liability % Recommendation</h2>
                            <button class="summary-button" id="getRecommendationButton" onclick="getLiabilityRecommendation()">
                                Get Recommendation
                            </button>
                        </div>
                    
                        <div class="liability-recommendation-content">
                            <div class="recommendation-form" id="recommendationForm" style="display: none;">
                                <div class="recommendation-percentages">
                                    <div class="percentage-input-group">
                                        <label for="claimantLiabilityPercent">Claimant Liability:</label>
                                        <div class="percentage-input-container">
                                            <input type="number" id="claimantLiabilityPercent" min="0" max="100" value="0" onchange="updateLiabilityPercentages()">
                                            <span class="percentage-symbol">%</span>
                                        </div>
                                    </div>
                                    <div class="percentage-input-group">
                                        <label for="otherDriverLiabilityPercent">Other Driver Liability:</label>
                                        <div class="percentage-input-container">
                                            <input type="number" id="otherDriverLiabilityPercent" min="0" max="100" value="0" onchange="updateLiabilityPercentages()">
                                            <span class="percentage-symbol">%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="recommendation-explanation">
                                    <label for="recommendationExplanation">Explanation:</label>
                                    <textarea id="recommendationExplanation" rows="10" placeholder="Explanation will appear here..."></textarea>
                                </div>
                                
                                <div class="recommendation-details">
                                    <div class="key-factors-section">
                                        <h3>Key Factors</h3>
                                        <ul id="keyFactorsList">
                                            <!-- Key factors will be rendered here -->
                                        </ul>
                                    </div>
                                    
                                    <div class="confidence-section">
                                        <h3>Confidence</h3>
                                        <div class="confidence-display">
                                            <div class="confidence-bar">
                                                <div class="confidence-fill" id="confidenceFill" style="width: 0%"></div>
                                            </div>
                                            <span class="confidence-text" id="confidenceText">0%</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="recommendation-actions">
                                    <button class="update-button" onclick="updateLiabilityRecommendation()">
                                        Update Recommendation
                                    </button>
                                </div>
                            </div>
                            
                            <div class="empty-state-container" id="recommendationEmptyState">
                                <p class="empty-state">Extract facts and analyze liability signals first, then click "Get Recommendation" to generate a liability percentage recommendation.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Timeline Reconstruction Tab -->
                <div class="tab-content" id="timelineTab" style="display: none;">
                    <div class="timeline-view" id="timelineView">
                        <div class="timeline-header">
                            <h2>Timeline Reconstruction</h2>
                            <div class="timeline-header-actions">
                                <button class="summary-button" id="generateTimelineButton" onclick="generateTimeline()">
                                    Generate Timeline
                                </button>
                                <button class="summary-button" id="saveTimelineButton" onclick="saveTimeline()" style="display: none;">
                                    Save Timeline
                                </button>
                            </div>
                        </div>
                    
                        <div class="timeline-content">
                            <div class="tab-loading" id="timelineLoading" style="display: none;">
                                <div class="spinner"></div>
                                <p>Processing...</p>
                            </div>
                            <div class="timeline-events-container" id="timelineEventsContainer" style="display: none;">
                                <ol class="timeline-events-list" id="timelineEventsList">
                                    <!-- Timeline events will be rendered here -->
                                </ol>
                            </div>
                            
                            <div class="empty-state-container" id="timelineEmptyState">
                                <p class="empty-state">Extract facts first, then click "Generate Timeline" to reconstruct the sequence of events leading to the collision.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Draft Claim Rationale Tab -->
                <div class="tab-content" id="claimRationaleTab" style="display: none;">
                    <div class="claim-rationale-view" id="claimRationaleView">
                        <div class="claim-rationale-header">
                            <h2>Draft Claim File Rationale</h2>
                            <button class="summary-button" id="generateRationaleButton" onclick="generateClaimRationale()">
                                Generate Rationale
                            </button>
                        </div>
                    
                        <div class="claim-rationale-content">
                            <div class="rationale-display" id="rationaleDisplay" style="display: none;">
                                <!-- Rationale will be displayed here -->
                            </div>
                            
                            <div class="empty-state-container" id="rationaleEmptyState">
                                <p class="empty-state">Extract facts and analyze liability signals first, then click "Generate Rationale" to create an audit-ready adjuster narrative.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Supervisor Escalation Package Tab -->
                <div class="tab-content" id="escalationPackageTab" style="display: none;">
                    <div class="escalation-package-view" id="escalationPackageView">
                        <div class="escalation-package-header">
                            <h2>Supervisor Escalation Packaging</h2>
                            <button class="summary-button" id="generateEscalationButton" onclick="generateEscalationPackage()">
                                Generate Escalation Package
                            </button>
                        </div>
                    
                        <div class="escalation-package-content">
                            <div class="escalation-display" id="escalationDisplay" style="display: none;">
                                <!-- Escalation package will be displayed here -->
                            </div>
                            
                            <div class="empty-state-container" id="escalationEmptyState">
                                <p class="empty-state">Extract facts and analyze liability signals first, then click "Generate Escalation Package" to create a condensed high-risk summary for supervisor review.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Navigation Buttons -->
                <div class="navigation-buttons">
                    <button class="nav-button prev-button" id="prevButton" onclick="goToPreviousStep()">
                        Previous
                    </button>
                    <button class="nav-button next-button" id="nextButton" onclick="goToNextStep()">
                        Next
                    </button>
                </div>
            </div>
        </div>

        <div class="loading" id="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Processing file...</p>
        </div>

        <div class="error" id="error" style="display: none;"></div>
        
        <!-- Hidden file input for uploads -->
        <input type="file" id="fileInput" accept=".pdf,.jpg,.jpeg,.png,.gif,.webp,.bmp" hidden>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>

